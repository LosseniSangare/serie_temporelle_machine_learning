---
title: "File_rouge"
author: "Eric, Losseni et Olivier "
date: "2023-12-17"
output: html_document
---
# Projet File Rouge

Dans le cadre du  projet fil rouuge, nous avons décidé de travailler sur des séries temporelles.
Pour ce fait nous utilisons des données de consommation d'électricité en Espagne.
Pour commencer nous appliquerons de 

```{r}
rm(list = ls())
```

#importation de nos données
```{r}
data <- read.csv("D:/UTT/FIL_ROUGE_MACHINE_LEARNING/Data/data.csv")
View(data)
```

```{r}
str(data)
```

#transformation des données

```{r}
# Charger la bibliothèque tidyr
library(tidyr)

# Séparer la colonne "datetime_utc" en colonnes de date et d'heure
data <- separate(data, datetime_utc, into = c("date", "heure"), sep = " ")

# Séparer la colonne "heure" en colonnes de heure et fuseau
data <- separate(data, heure, into = c("heure", "fuseau"), sep = "\\+")

#suppression de la colonne fuseaux
data<- subset(data, select = -fuseau)

#renommage de l'entête
colnames(data) = c("date","heure", "conso_totale","emission_co2","conso_particulier","prix")

# Afficher les premières lignes du résultat
head(data)

```


```{r}
data_new=subset(data, select = -conso_particulier)
head(data_new)
```
```{r}
library(ggplot2)
```


```{r}
# Assurez-vous que la colonne date est au format POSIXct
data_new$date <- as.POSIXct(data_new$date)

# Ajouter des colonnes pour le mois et l'année
data_new$mois <- format(data_new$date, "%m")
data_new$annee <- format(data_new$date, "%Y")

# Filtrer les données pour janvier 2014
data_january_2014 <- data_new[data_new$annee == "2014" & data_new$mois == "01", ]

# Créer un graphique de la série temporelle
ggplot(data_january_2014, aes(x = date, y = conso_totale)) +
  geom_smooth() +
  labs(title = "Série temporelle de conso_totale - Janvier 2014",
       x = "Date",
       y = "conso_totale")

```


```{r}
#install.packages("dplyr")
library(dplyr)
library(lubridate) # pour la conversion du type de date et heure
data$date = ymd(data$date)
data$heure = hms(data$heure)
#recuperation unique des heure sans les minute
#data$heure = hour(data$heure)
```

## ajout de nouvelle colonne années, mois, jour

```{r}
data$annee = year(data$date)
data$mois = month(data$date)
data$jour = day(data$date)

#suppresion de la colonne date
data = subset(data, select = -date)
```

```{r}
head(data)
```

## verification des valeurs manquantes

valeurs mamquante par colonne
```{r}
missing_values <- colSums(is.na(data))
missing_values
```
Nombre total de valeurs manquante
```{r}
total_missing_values <- sum(missing_values)
total_missing_values
```
Comme on l'avait constaté, il n'y a aucune valeur maquante dans ce jeu de données


# Analyse descriptive

```{r}
data_new = subset(data, select = - conso_particulier)
str(data_new)
```

```{r}
summary(data_new)
```


```{r}
#boxplot(data$energie_consomme,data$demande_predite, data$emission_co2, main = "Boîte à moustaches des variable")
```



```{r}
pairs(data_new)
``` 
On remarque visiblement que  consommation d'energie est forement corrélé à la demande prédite et 

```{r}
cor(data_new)
```

on vois bien que la consommation d'energy est fortement corrélé positivement à 98,64 % à la prévision de demande et moyennement corrélé positivement à la production de c02 soit 50,39%


## Séparation des donné en entraînement et test

pour ce jeu de donnée, nous avons décidé d'utiliser que les données des deux dernières années comme nos données de test et celles des années précédente comme nos données de validation
```{r}
test_start = as.Date(2021)
train_data = data_new %>% filter(annee < test_start)
test_data = data_new %>% filter(annee >= test_start)
```




```{r}
str(data_new)
```

```{r}
data_new$date <- as.POSIXct(paste(data_new$annee, data_new$mois, data_new$jour, data_new$heure, sep = "-"))
head(data_new)

summary(data_new)

data_new$date <- as.POSIXct(paste(data_new$annee, data_new$mois, data_new$jour, data_new$heure, sep = "-"), format="%Y-%m-%d %H")

head(data_new)


```



```{r}
library(ggplot2)
# Créer un objet de type Date
#data$date <- as.Date(paste(data$annee, data$mois, data$jour, data$heure, sep = "-"))
#data$date2 <- paste(2014, 02, 01, data$heure, sep = "-")
#subset_data <- data[data$date >= as.POSIXct("2014-01-01"),]
start = as.Date(2014)
subset_data = data %>% filter(annee == start)

# Créer un graphique de la série temporelle
ggplot(subset_data, aes(x = date, y = energie_consomme)) +
  geom_line() +
  labs(title = "Série temporelle de energie_consomme",
       x = "Date",
       y = "energie_consomme")

```



```{r}
daily_avg <- data %>%
  group_by(date) %>%
  summarise(avg_energie_consomme = mean(energie_consomme))

head(daily_avg)
data$daily_avg
```



```{r}
test_start2 = as.Date(2014)
plot_data = data %>% filter(annee == test_start2)
```



```{r}
# Créer un objet de type Date
data$date <- as.Date(paste(2014, data$mois, data$jour, sep = "-"))

# Créer un graphique de la série temporelle
ggplot(data, aes(x = date, y = energie_consomme)) +
  geom_line() +
  labs(title = "Série temporelle de energie_consomme",
       x = "Date",
       y = "energie_consomme")

```

```{r}
daily_avg <- data %>%
  group_by(date) %>%
  summarise(avg_energie_consomme = mean(energie_consomme))

head(daily_avg)
data$daily_avg
```
```{r}
# Créer un objet de type Date
data$date <- as.Date(paste(2014, data$mois, data$jour, sep = "-"))

# Créer un graphique de la série temporelle
ggplot(data, aes(x = date, y = daily_avg)) +
  geom_line() +
  labs(title = "Série temporelle de energie_consomme",
       x = "Date",
       y = "energie_consomme")

```


## Entrainement de nos model avec la regression simple

```{r}
r1 = lm(train_data$conso_totale ~ mois + jour, data = train_data) 
summary(r1)
```
l'erreur standard est de 710,6 sur 61465 dégrée de liberté. 
R² nous montre que 97,16% des données d'entrainement sont expliquées par le modèle.

```{r}
ggplot(train_data)+aes(x=demande_predite,y=energie_consomme)+geom_point()+ geom_smooth(method = "lm",lwd=3) + theme_minimal()
```
## prediction sur les données de test
```{r}
pred = predict(r1, newdata = test_data)
```

```{r}
# Créer un dataframe avec les prédictions et les valeurs réelles
results <- data.frame(Reel = test_data$conso_totale, Prediction = pred)

# Afficher les premières lignes du dataframe
head(results)

```


##Erreur quadratique moyenne (RMSE) :

elle mesure l'écart quadratique moyen entre les valeurs prédites et les valeurs réelles.

```{r}
rmse <- sqrt(mean((test_data$conso_totale - pred)^2))
taille= length(test_data$conso_totale)
rmse
(taille-rmse)/taille
```


```{r}
mae <- mean(abs(test_data$conso_totale - pred))
(taille-mae)/taille
```
#Coefficient de détermination (R²)

```{r}
ssr <- sum((pred - mean(test_data$conso_totale))^2)
sst <- sum((test_data$conso_totale - mean(test_data$conso_totale))^2)
r_squared <- ssr / sst
r_squared
```

NB: Un R² élevé est généralement un indicateur positif, car il signifie que le modèle est capable de capturer la variation dans les données et de fournir des prédictions précises. Cependant, il est également important d'être conscient des limitations possibles du R², notamment son insensibilité à des problèmes tels que les erreurs de spécification du modèle.

```{r}

```

